<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<title>TellerDesk</title>
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
<style>
body{font-family:sans-serif;background:#111;color:#eee}
#conn{padding:4px 8px;border-radius:6px}
.online{background:#0a5}
.offline{background:#a33}
</style>
</head>
<body>
<h1>TellerDesk</h1>
<span id="conn" class="offline">OFFLINE</span>
<br/>
<label>텔러 코드 <input id="code" value="0612"/></label>
<button id="login">로그인</button>
<button id="save">온라인 저장</button>
<script>
const conn=document.getElementById('conn');
async function ping(){
 try{
  const r=await fetch('/.netlify/functions/bank?ping=1');
  if(await r.text()==='pong'){conn.textContent='ONLINE';conn.className='online';}
 }catch(e){}
}
ping();
document.getElementById('login').onclick=()=>netlifyIdentity.open('login');
document.getElementById('save').onclick=async()=>{
 const u=netlifyIdentity.currentUser(); if(!u) return alert('로그인 필요');
 const t=await u.jwt();
 const r=await fetch('/.netlify/functions/bank',{method:'POST',headers:{'Authorization':'Bearer '+t,'Content-Type':'application/json'},
 body:JSON.stringify({action:'tellerDeskSet',payload:{tellerCode:document.getElementById('code').value,data:{ts:Date.now()}}})});
 alert(r.status);
};
</script>
</body>
</html>
